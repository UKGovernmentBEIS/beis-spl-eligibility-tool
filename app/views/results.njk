{% from "back-link/macro.njk" import govukBackLink %}
{% from "table/macro.njk" import govukTable %}
{% from "hidden-fields/macro.njk" import appendHiddenFields %}
{% from "button/macro.njk" import govukButton %}
{% from "./components/parent-eligibility-results.njk" import parentEligibilityResults %}

{% extends "layout.njk" %}

{% block pageTitle -%}
  {{ "Eligibility results" | pageTitle }}
{%- endblock %}

{% block beforeContent %}
  {{ super() }}

  {{ govukBackLink({
    text: "Back",
    href: backPath()
  }) }}
{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-xl">
        Check if you can get shared parental leave and pay
      </h1>
      <p>
        Choose which parent you want to check eligibility for below.
      </p>
      <form method="POST">
        {% call appendHiddenFields(data) %}
          {% for parent in ["primary", "secondary"] %}
            {{ parentEligibilityResults({
              data: data,
              parent: parent
            }) }}
          {% endfor %}
        {% endcall %}
      </form>
      {% if data | hasCheckedAnyEligibility %}
        <h2 class="govuk-heading-m">
          Next steps
        </h2>
        {% if data | coupleHasAnyIneligibility %}
          <p>
            To understand why you or your partner are not eligible for shared parental leave or shared parental pay, you can check the guidelines on
            {% if data | isBirth %}
              <a href="{{ mainstream_guidance_root_path }}/eligibility-for-birth-parents">eligibility for birth parents</a>.
            {% elif data | isAdoption %}
              <a href="{{ mainstream_guidance_root_path }}/eligibility-for-adopters">eligibility for adopters</a>.
            {% else %}
              {# TODO check that this link is appropriate for surrogate parents #}
              <a href="{{ mainstream_guidance_root_path }}/eligibility-for-adopters">eligibility for adopters</a>.
            {% endif %}
          </p>
        {% endif %}
        <p>
          If you or your partner are eligible, you can
          <a href="{{ planner_root_path + '?' + plannerQueryString }}">plan how to take shared parental leave and pay</a>.
        </p>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block bodyEnd %}
  {{ super() }}
  <script>
    {% set eligibilities = data | resultsAnalyticsData | dump | safe %}
    window.analytics.eligibility({{ eligibilities }})
  </script>
{% endblock %}
